
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perceptron Training Demo</title>
    <style>
        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 10px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            font-size: 32px;
        }
    </style>
</head>
<body>

    <h1>Perceptron Training Demo</h1>

    <div id="perceptron-demo-v9" style="font-family: 'Open Sans', sans-serif; max-width: 950px; margin: 0 auto; border: 1px solid #e1e4e8; border-radius: 8px; background: #fafbfc; padding: 30px 20px 20px 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
        
        <style>
            /* --- Layout --- */
            #perceptron-demo-v9 .pd-container {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: flex-start; 
                gap: 10px;
                margin-top: 40px;
            }

            #perceptron-demo-v9 .pd-section { 
                display: flex; 
                flex-direction: column; 
                align-items: center; 
            }
            
            /* Arrows */
            #perceptron-demo-v9 .pd-arrow { 
                font-size: 28px; 
                color: #bdc3c7; 
                margin: 0 5px; 
                margin-top: 120px; 
            }

            /* --- Perceptron Circle --- */
            #perceptron-demo-v9 .perceptron-circle {
                width: 300px; 
                height: 300px;
                border-radius: 50%;
                border: 5px solid #3b7dc0;
                background-color: #fff;
                display: flex;
                justify-content: center;
                align-items: center;
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
                position: relative;
            }
            #perceptron-demo-v9 .perceptron-label { 
                position: absolute; 
                top: -40px; /* This reduces the space below the word and above the circle */
                font-weight: 700; 
                color: #3b7dc0; 
                font-size: 18px; 
                letter-spacing: 1px;
            }
            
            /* --- Grids (8x8) --- */
            #perceptron-demo-v9 .grid-8x8 {
                display: grid;
                grid-template-columns: repeat(8, 1fr);
                gap: 1px;
                width: 240px; 
                height: 240px;
                background-color: #ccc;
                border: 2px solid #444;
            }
            
            /* Weight Cells */
            #perceptron-demo-v9 .cell-weight {
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 13px;
                color: #333;
                background: #f8f9fa;
                font-family: monospace;
                overflow: hidden;
            }
            
            /* Input Pixel Cells */
            #perceptron-demo-v9 .cell-pixel {
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: 'Courier New', monospace;
                font-size: 18px; 
                font-weight: bold;
            }
            #perceptron-demo-v9 .pixel-off { background-color: #222; color: #555; }
            #perceptron-demo-v9 .pixel-on { background-color: #fff; color: #000; }

            /* --- Output Module --- */
            #perceptron-demo-v9 .output-module {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                border: 3px solid #3b7dc0;
                background: #f0f7ff;
                border-radius: 10px;
                width: 140px;
                height: 110px;
                box-shadow: 0 3px 6px rgba(0,0,0,0.1);
                margin-top: 70px;
            }
            #perceptron-demo-v9 .output-status-label { 
                font-size: 13px; 
                font-weight: 800; 
                margin-bottom: 5px; 
                padding: 4px 10px; 
                border-radius: 20px;
                letter-spacing: 0.5px;
            }
            #perceptron-demo-v9 .status-wait { color: #555; background: #e2e6ea; }
            #perceptron-demo-v9 .status-correct { color: #155724; background-color: #d4edda; }
            #perceptron-demo-v9 .status-incorrect { color: #721c24; background-color: #f8d7da; }
            
            #perceptron-demo-v9 .output-sum-val { 
                font-size: 26px; 
                font-family: monospace; 
                font-weight: 700; 
                color: #2c3e50; 
                margin: 5px 0;
            }
            #perceptron-demo-v9 .output-sum-title { font-size: 11px; color: #7f8c8d; text-transform: uppercase; font-weight: 600;}


            /* --- Feedback Panel --- */
            #perceptron-demo-v9 .feedback-panel {
                background: white;
                border: 1px solid #d1d9e6;
                border-left: 5px solid #3b7dc0; 
                padding: 8px 12px;
                border-radius: 4px;
                font-size: 13px;
                line-height: 1.4;
                color: #2c3e50;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                width: 280px; 
                margin-top: 15px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            
            #perceptron-demo-v9 .feedback-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 4px;
                border-bottom: 1px solid #eee;
                padding-bottom: 4px;
            }
            #perceptron-demo-v9 .feedback-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
            #perceptron-demo-v9 .fb-label { font-weight: 600; color: #555; font-size: 12px; }
            #perceptron-demo-v9 .fb-val { font-family: monospace; font-weight: 600; text-align: right; margin-left: 5px;}
            #perceptron-demo-v9 .fb-action { color: #d63384; font-weight: bold; } 

            /* --- Controls Bar --- */
            #perceptron-demo-v9 .controls { 
                margin-top: 20px; 
                display: flex; 
                flex-wrap: wrap;
                gap: 15px; 
                justify-content: center; 
                align-items: center;
                border-top: 1px solid #eee; 
                padding-top: 25px;
            }
            
            /* Buttons */
            #perceptron-demo-v9 .btn {
                padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600;
                transition: all 0.2s;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                height: 40px; /* Fixed height for alignment with select */
            }
            #perceptron-demo-v9 .btn-primary { background-color: #3b7dc0; color: white; }
            #perceptron-demo-v9 .btn-primary:hover { background-color: #2a5a8f; transform: translateY(-1px); }
            
            #perceptron-demo-v9 .btn-secondary { background-color: #e9ecef; color: #495057; }
            #perceptron-demo-v9 .btn-secondary:hover { background-color: #dee2e6; }
            
            #perceptron-demo-v9 .btn-reset { background-color: #fff; color: #dc3545; border: 1px solid #dc3545; }
            #perceptron-demo-v9 .btn-reset:hover { background-color: #dc3545; color: white; }

            #perceptron-demo-v9 .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

            /* Select Box Styling */
            #perceptron-demo-v9 .select-group {
                display: flex;
                align-items: center;
                gap: 8px;
                background: #fff;
                padding: 0 10px;
                border-radius: 5px;
                border: 1px solid #ccc;
                height: 40px; /* Match button height */
                box-sizing: border-box;
            }
            #perceptron-demo-v9 .digit-select {
                border: none;
                font-size: 14px;
                font-weight: bold;
                color: #333;
                cursor: pointer;
                outline: none;
                background: transparent;
            }
            
            #perceptron-demo-v9 .grid-title { font-size: 12px; margin-bottom: 10px; color: #6c757d; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;}

        </style>

        <div class="pd-container">
            <div class="pd-section">
                <div class="grid-title">Input Image</div>
                <div id="input-grid-v9" class="grid-8x8"></div>
            </div>

            <div class="pd-arrow">&#8594;</div>

            <div class="pd-section">
                <div class="perceptron-circle">
                    <span class="perceptron-label">PERCEPTRON</span>
                    <div id="weight-grid-v9" class="grid-8x8"></div>
                </div>
                
                <div id="feedback-panel-v9" class="feedback-panel">
                    <div style="text-align: center; color: #666; font-style: italic;">
                        Target: <b>Digit 0</b><br/>
                        Click "Next" to start.
                    </div>
                </div>
            </div>

             <div class="pd-arrow">&#8594;</div>

             <div class="pd-section">
                 <div class="grid-title">Prediction</div>
                 <div class="output-module">
                    <div id="output-status-v9" class="output-status-label status-wait">WAITING</div>
                    <div id="output-sum-v9" class="output-sum-val">--</div>
                    <div class="output-sum-title">Weighted Sum</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="select-group">
                <label for="target-digit-v9" style="font-size: 13px; font-weight: 600; color: #555;">Target:</label>
                <select id="target-digit-v9" class="digit-select" onchange="perceptronDemoV9.setTarget(this.value)">
                    <option value="0" selected>Digit 0</option>
                    <option value="1">Digit 1</option>
                    <option value="2">Digit 2</option>
                    <option value="3">Digit 3</option>
                    <option value="4">Digit 4</option>
                    <option value="5">Digit 5</option>
                    <option value="6">Digit 6</option>
                    <option value="7">Digit 7</option>
                    <option value="8">Digit 8</option>
                    <option value="9">Digit 9</option>
                </select>
            </div>

            <button id="btn-reset-v9" class="btn btn-reset" onclick="perceptronDemoV9.reset()">Reset</button>
            <button id="btn-prev-v9" class="btn btn-secondary" onclick="perceptronDemoV9.prev()" disabled>Previous</button>
            <button id="btn-next-v9" class="btn btn-primary" onclick="perceptronDemoV9.next()">Next</button>
        </div>
        <div style="text-align:center; margin-top: 10px; font-size: 12px; color: #aaa;" id="step-counter-v9">Step: 0</div>

        <script>
            class PerceptronDemoV9 {
                constructor() {
                    this.gridSize = 64; // 8x8
                    this.history = []; 
                    this.stepIndex = -1;
                    this.currentWeights = new Array(this.gridSize).fill(0);
                    this.targetDigit = 0; // Default

                    // --- Digit Presets (8x8) ---
                    this.digitPresets = {
                        0: [0,0,1,1,1,1,0,0, 0,1,0,0,0,0,1,0, 1,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,1, 1,0,0,0,0,0,0,1, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,0,0],
                        1: [0,0,0,1,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,1,1,1,1,0,0],
                        2: [0,0,1,1,1,1,0,0, 0,1,0,0,0,0,1,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,1,0,0, 0,0,0,0,1,0,0,0, 0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,1,1,1,0],
                        3: [0,1,1,1,1,1,1,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,1,0,0, 0,0,0,1,1,1,0,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,0,0],
                        4: [0,0,0,0,1,0,0,0, 0,0,0,1,1,0,0,0, 0,0,1,0,1,0,0,0, 0,1,0,0,1,0,0,0, 1,1,1,1,1,1,1,0, 0,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0],
                        5: [0,1,1,1,1,1,1,0, 0,1,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,1,1,1,1,1,0,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,0,0],
                        6: [0,0,1,1,1,1,0,0, 0,1,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,1,1,1,1,1,0,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,0,0],
                        7: [0,1,1,1,1,1,1,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,1,0,0, 0,0,0,0,1,0,0,0, 0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0],
                        8: [0,0,1,1,1,1,0,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,0,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,0,0],
                        9: [0,0,1,1,1,1,0,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,1,1,1,1,0, 0,0,0,0,0,0,1,0, 0,0,0,0,0,0,1,0, 0,0,1,1,1,1,0,0]
                    };

                    this.dom = {
                        inputGrid: document.getElementById('input-grid-v9'),
                        weightGrid: document.getElementById('weight-grid-v9'),
                        outputStatus: document.getElementById('output-status-v9'),
                        outputSum: document.getElementById('output-sum-v9'),
                        feedback: document.getElementById('feedback-panel-v9'),
                        btnPrev: document.getElementById('btn-prev-v9'),
                        btnNext: document.getElementById('btn-next-v9'),
                        stepCounter: document.getElementById('step-counter-v9')
                    };

                    // Initialize empty view
                    this.reset();
                }

                setTarget(val) {
                    this.targetDigit = parseInt(val);
                    this.reset();
                }

                reset() {
                    this.history = [];
                    this.stepIndex = -1;
                    this.currentWeights = new Array(this.gridSize).fill(0);
                    
                    // Clear Grids
                    this.renderGrid(this.dom.inputGrid, new Array(this.gridSize).fill(0), 'pixel');
                    this.renderGrid(this.dom.weightGrid, this.currentWeights, 'weight');
                    
                    // Reset Text
                    this.dom.outputSum.innerText = "--";
                    this.dom.outputStatus.innerText = "WAITING";
                    this.dom.outputStatus.className = "output-status-label status-wait";
                    
                    this.dom.feedback.innerHTML = `<div style="text-align: center; color: #666; font-style: italic;">
                        Target: <b>Digit ${this.targetDigit}</b><br/>Click "Next" to start.
                    </div>`;
                    this.dom.stepCounter.innerText = "Step: 0";
                    
                    // Reset Buttons
                    this.dom.btnPrev.disabled = true;
                    this.dom.btnNext.disabled = false;
                }

                // --- Logic ---

                generateInput() {
                    // 50% probability it is the target digit, 50% it is something else
                    const isTarget = Math.random() > 0.5;
                    let pixels = [];
                    let basePixels = [];

                    if (isTarget) {
                        basePixels = [...this.digitPresets[this.targetDigit]];
                    } else {
                        // Pick a random digit that is NOT the target
                        const allKeys = Object.keys(this.digitPresets).map(k => parseInt(k));
                        const otherKeys = allKeys.filter(k => k !== this.targetDigit);
                        const randomOther = otherKeys[Math.floor(Math.random() * otherKeys.length)];
                        basePixels = [...this.digitPresets[randomOther]];
                    }

                    // Add Noise/Perturbation
                    pixels = [...basePixels];
                    const noiseAmount = Math.floor(Math.random() * 4) + 1; // 1 to 4 pixels flipped
                    for(let k=0; k<noiseAmount; k++) {
                        const idx = Math.floor(Math.random() * this.gridSize);
                        pixels[idx] = pixels[idx] === 1 ? 0 : 1;
                    }

                    return { pixels, isTarget };
                }

                calculate(pixels, weights) {
                    let sum = 0;
                    for(let i=0; i<this.gridSize; i++) sum += pixels[i] * weights[i];
                    return sum;
                }

                next() {
                    if (this.stepIndex < this.history.length - 1) {
                        this.stepIndex++;
                        this.renderState(this.history[this.stepIndex]);
                        return;
                    }

                    const { pixels, isTarget } = this.generateInput();
                    const weightsBefore = [...this.currentWeights];
                    const sum = this.calculate(pixels, weightsBefore);
                    
                    // --- Decision Logic ---
                    // Prediction: Sum > 0 => "Is Target", Sum <= 0 => "Not Target"
                    
                    let isCorrect = false;
                    let statusLabel = "";
                    let typeText = isTarget ? `Digit ${this.targetDigit}` : "Other Digit";
                    let predText = sum > 0 ? `Digit ${this.targetDigit}` : "Other";
                    let actionText = "";
                    let actionCode = "NONE"; // ADD, SUBTRACT, NONE

                    if (sum > 0) {
                        // Predicts Is Target
                        if (isTarget) {
                            isCorrect = true;
                            statusLabel = "CORRECT";
                            actionText = "None";
                        } else {
                            // False Positive (Predicted Target, but was Other)
                            isCorrect = false;
                            statusLabel = "INCORRECT";
                            actionCode = "SUBTRACT";
                            actionText = "Subtract Input";
                        }
                    } else {
                        // Predicts Not Target
                        if (isTarget) {
                            // False Negative (Predicted Other, but was Target)
                            isCorrect = false;
                            statusLabel = "INCORRECT";
                            actionCode = "ADD";
                            actionText = "Add Input";
                        } else {
                            isCorrect = true;
                            statusLabel = "CORRECT";
                            actionText = "None";
                        }
                    }

                    // Update Weights
                    const weightsAfter = [...weightsBefore];
                    if (actionCode === "ADD") {
                        for(let i=0; i<this.gridSize; i++) weightsAfter[i] += pixels[i];
                    } else if (actionCode === "SUBTRACT") {
                        for(let i=0; i<this.gridSize; i++) weightsAfter[i] -= pixels[i];
                    }

                    const newState = {
                        pixels, weightsBefore, weightsAfter, sum, 
                        isCorrect, statusLabel, typeText, predText, actionText, actionCode,
                        stepId: this.stepIndex + 2
                    };

                    this.history.push(newState);
                    this.currentWeights = weightsAfter;
                    this.stepIndex++;
                    this.renderState(newState);
                }

                prev() {
                    if (this.stepIndex > 0) {
                        this.stepIndex--;
                        this.renderState(this.history[this.stepIndex]);
                    }
                }

                renderState(state) {
                    this.renderGrid(this.dom.inputGrid, state.pixels, 'pixel');
                    this.renderGrid(this.dom.weightGrid, state.weightsBefore, 'weight');
                    
                    this.dom.outputSum.innerText = state.sum;
                    this.dom.outputStatus.innerText = state.statusLabel;
                    this.dom.outputStatus.className = 'output-status-label ' + (state.isCorrect ? 'status-correct' : 'status-incorrect');
                    this.dom.stepCounter.innerText = `Step: ${state.stepId}`;
                    this.dom.btnPrev.disabled = (this.stepIndex === 0);

                    // Formatted Feedback
                    const colorClass = state.isCorrect ? "color: #155724;" : "color: #721c24;";
                    const actionHtml = state.actionCode !== "NONE" 
                        ? `<span class="fb-action">${state.actionText}</span>` 
                        : state.actionText;

                    this.dom.feedback.innerHTML = `
                        <div class="feedback-row">
                            <span class="fb-label">Truth:</span>
                            <span class="fb-val">${state.typeText}</span>
                        </div>
                        <div class="feedback-row">
                            <span class="fb-label">Prediction:</span>
                            <span class="fb-val" style="${colorClass}">${state.predText} (Sum ${state.sum > 0 ? '>0' : 'â‰¤0'})</span>
                        </div>
                        <div class="feedback-row">
                            <span class="fb-label">Action:</span>
                            <span class="fb-val">${actionHtml}</span>
                        </div>
                    `;
                }

                renderGrid(container, data, type) {
                    container.innerHTML = '';
                    data.forEach(val => {
                        const cell = document.createElement('div');
                        if (type === 'pixel') {
                            cell.className = `cell-pixel ${val === 1 ? 'pixel-on' : 'pixel-off'}`;
                            cell.innerText = val;
                        } else {
                            cell.className = 'cell-weight';
                            cell.innerText = val;
                            // Color scale for weights
                            if(val > 0) {
                                 // Lighter/Brighter Green scale (75, 200, 90)
                                 cell.style.backgroundColor = `rgba(75, 200, 90, ${Math.min(0.1 + (Math.abs(val)/20), 0.6)})`;
                            } else if (val < 0) {
                                 // Red scale
                                 cell.style.backgroundColor = `rgba(220, 53, 69, ${Math.min(0.1 + (Math.abs(val)/20), 0.5)})`;
                            } else {
                                cell.style.backgroundColor = '#f8f9fa';
                            }
                        }
                        container.appendChild(cell);
                    });
                }
            }

            const perceptronDemoV9 = new PerceptronDemoV9();
        </script>
    </div>

</body>
</html>